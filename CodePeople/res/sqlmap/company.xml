<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE sqlMap
			PUBLIC "-//ibatis.apache.org//DTD SQL Map 2.0//EN"
			"http://ibatis.apache.org/dtd/sql-map-2.dtd">

<sqlMap namespace="company">
	<resultMap class="kr.or.ddit.company.vo.CompanyVO" id="CompanyMap">
		<result column="PROV_CODE_NO" property="provCodeNo"/>
		<result column="CITY_CODE_NO" property="cityCodeNo"/>
		<result column="COM_INTRO" property="comIntro"/>
		<result column="COM_DETAIL" property="comDetail"/>
		<result column="COM_NO" property="comNo"/>
		<result column="MEM_NO" property="memNo"/>
		<result column="JG_CODE_NO" property="jgCodeNo"/>
		<result column="COM_NM" property="comNm"/>
		<result column="COM_DATE" property="comDate"/>
		<result column="COM_CNT" property="comCnt"/>
		<result column="COM_HPG" property="comHpg"/>
		<result column="COM_FAV" property="comFav"/>
		<result column="COM_SAL" property="comSal"/>
		<result column="COM_REV" property="comRev"/>
	</resultMap>
	
	<resultMap class="java.util.HashMap" id="companyDetailMap">
		<result column="COM_NM" property="COM_NM" />
		<result column="COM_HPG" property="COM_HPG" />
		<result column="COM_DATE" property="COM_DATE" />
		<result column="COM_CNT" property="COM_CNT" />
		<result column="COM_SAL" property="COM_SAL" />
		<result column="JG_CODE_NM" property="JG_CODE_NM" />
		<result column="JO_TITLE" property="JO_TITLE" />
		<result column="JO_SAL" property="JO_SAL" />
		<result column="REV_CRR" property="REV_CRR" />
		<result column="REV_SAL" property="REV_SAL" />
		<result column="REV_CUL" property="REV_CUL" />
		<result column="REV_EXECS" property="REV_EXECS" />
		<result column="REV_COMT" property="REV_COMT" />
		<result column="PROV_CODE_NM" property="PROV_CODE_NM" />
		<result column="CITY_CODE_NM" property="CITY_CODE_NM" />
	</resultMap>
	
	<select id="companyPagingList" parameterClass="kr.or.ddit.cmm.vo.CompanyPagingVO" 
		    resultMap="CompanyMap">
		SELECT AA.*
		  FROM (SELECT ROWNUM AS RNUM, A.*  
		          FROM (SELECT *
		                  FROM V_COM_SEARCH) A) AA
		 WHERE AA.RNUM BETWEEN #firstRecNo# AND #lastRecNo#
	</select>
	
	
	
	<select id="getTotalCompanyCount" resultClass="int">
		SELECT COUNT(*)
		  FROM COMPANY
	</select>
	
		<insert id="companyInsert" parameterClass="kr.or.ddit.company.vo.CompanyVO">
			INSERT INTO COMPANY VALUES		
        (COMPANY_SEQ.NEXTVAL
        ,1
        ,1
		 ,#comNm#
		 ,#comDate#
		 ,#comCnt#
		 ,#comHpg#
        ,100
		 ,#comSal#
        ,1
        ,1
        ,#comIntro#
        ,#comDetail#)
        
        
				<selectKey keyProperty="comNo" resultClass="int">
					SELECT COMPANY_SEQ.CURRVAL FROM DUAL
				</selectKey>
	</insert>
	
		<select id="" resultMap="companyDetailMap" parameterClass="int">
		SELECT AA.* FROM 
				(SELECT ROWNUM AS RNUM, A.* FROM 
						(SELECT * FROM 
								(SELECT A.COM_NM, A.COM_HPG, A.COM_DATE, A.COM_CNT, A.COM_SAL,	B.JG_CODE_NM, C.JO_TITLE,	C.JO_SAL, 
												D.REV_CRR, D.REV_SAL, D.REV_CUL, D.REV_EXECS, D.REV_COMT,	E.PROV_CODE_NM, F.CITY_CODE_NM
												FROM V_COM_SEARCH A
												INNER JOIN JOB_GROUP B ON(A.JG_CODE_NO = B.JG_CODE_NO)
												INNER JOIN JOB_OPENING C ON(A.COM_NO = C.COM_NO)
												INNER JOIN REVIEW D ON(A.COM_NO = D.COM_NO)
												INNER JOIN PROV E ON(A.PROV_CODE_NO = E.PROV_CODE_NO)
												INNER JOIN CITY F ON(A.CITY_CODE_NO = F.CITY_CODE_NO)
												WHERE 1 = 1
												AND E.CITY_CODE_NO = F.CITY_CODE_NO
												AND COM_NO = #COM_NO#
								) 
						G) 
				A) 
		AA;
	</select>
	
</sqlMap>